extends ../layout

block content
  h1 Customer #{profile.customerId}
  a.btn.btn-link(href='/ct') Back to dashboard
  .mt-3
    h2 Summary
    if profile.totalCases
      p Cases: #{profile.totalCases} (open #{profile.summary.open}, closed #{profile.summary.closed})
      if profile.defectCounts
        p Defect claims: #{profile.defectCounts.total} total#{profile.defectCounts.ongoing ? ` (+${profile.defectCounts.ongoing} open)` : ''}
    else
      p.text-muted No cases recorded for this customer.
    if Object.keys(profile.summary.byStatus || {}).length
      ul
        each val, key in profile.summary.byStatus
          li #{key}: #{val}
  if profile.matrix && profile.matrix.rows && profile.matrix.rows.length
    h2 Type vs. Solution
    table.table.table-dark.table-striped
      thead
        tr
          th Type
          each col in profile.matrix.columns
            th= col
      tbody
        each row in profile.matrix.rows
          tr
            td= row.type
            each cell in row.cells
              - const display = cell.completed || cell.ongoing ? `${cell.completed}${cell.ongoing ? ` (+${cell.ongoing})` : ''}` : '—'
              td= display
  hr
  h2 Cases
  if profile.cases && profile.cases.length
    table.table.table-dark.table-striped
      thead
        tr
          th Order
          th Type
          th Status
          th Solution
          th Deadline
          th Staff
      tbody
        each c in profile.cases
          tr
            td
              a(href=`/ct/case/${c.id}`)= c.order
            td= c.type || '—'
            td= c.status || '—'
            td= c.solution || '—'
            td= c.deadline ? ((new Date(c.deadline)).toISOString().split('T')[0]) : '—'
            td= c.staff_in_charge || '—'
  else
    p.text-muted No cases recorded for this customer.
