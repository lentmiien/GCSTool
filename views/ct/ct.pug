extends ../layout

block content
  h1 Case Tracker
  if message
    .alert.alert-warning= message
  form(action='/ct/search', method='post', class='mb-4')
    .input-group
      input#ct-search.form-control(type='text', name='query', placeholder='Order number, tracking number, customer ID, or item code', required)
      button.btn.btn-primary(type='submit') Search
  if casesDueSoon && casesDueSoon.length
    h2 Upcoming Deadlines (next #{days} days)
    table.table.table-dark.table-striped
      thead
        tr
          th Order
          th Type
          th Status
          th Deadline
          th Staff
      tbody
        each c in casesDueSoon
          tr
            td
              a(href=`/ct/case/${c.id}`)= c.order
            td= c.type || '—'
            td= c.status || '—'
            td= c.deadline ? ((new Date(c.deadline)).toISOString().split('T')[0]) : '—'
            td= c.staff_in_charge || '—'
  else
    p.text-muted No cases have deadlines within the next #{days} days.
  hr
  p.mb-2 Need to create something new?
  a.btn.btn-outline-primary.me-2(href='/ct/case/new') Create a new case
  a.btn.btn-outline-secondary.me-2(href='/ct/items') View item trends
  a.btn.btn-outline-secondary(href='/ct/audit') View recent activity
